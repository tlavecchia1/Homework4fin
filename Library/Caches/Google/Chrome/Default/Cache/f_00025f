var VpaidVideoPlayer=function(){this.slot_=null,this.videoSlot_=null,this.eventsCallbacks_={},this.attributes_={companions:"",desiredBitrate:256,duration:30,expanded:!1,height:0,icons:"",linear:!0,remainingTime:10,skippableState:!1,viewMode:"normal",width:0,volume:1},this.quartileEvents_=[{event:"AdVideoStart",value:0},{event:"AdVideoFirstQuartile",value:25},{event:"AdVideoMidpoint",value:50},{event:"AdVideoThirdQuartile",value:75},{event:"AdVideoComplete",value:100}],this.lastQuartileIndex_=0,this.parameters_={config_url:"",page_url:"",stop_url:""},this.trackingevent_urls={},this.impression_urls=[],this.impressionFired=!1,this.environmentVars={},this.elements=[],this.currentVPAIDCreative=null,this.stopped=!1,this.lastEventTime=null,this.ads_attempted=0,this.startTime=0};VpaidVideoPlayer.prototype.handshakeVersion=function(e){return e},VpaidVideoPlayer.prototype.initAd=function(e,t,i,n,r,a){this.startTime=(new Date).getTime(),this.attributes_.width=e,this.attributes_.height=t,this.attributes_.viewMode=i,this.attributes_.desiredBitrate=n,this.slot_=a.slot,this.videoSlot_=a.videoSlot,this.environmentVars=a;var s=!0;try{var o=new DOMParser,d=o.parseFromString(r.AdParameters.replace(/&/g,"&amp;"),"text/xml")}catch(l){s=!1}if(s)if(1===d.getElementsByTagName("config").length){var u=d.getElementsByTagName("config")[0];if(1===u.getElementsByTagName("config_url").length){var p=u.getElementsByTagName("config_url")[0].firstChild.nodeValue.trim();if(p.length>0){var c="undefined";1===u.getElementsByTagName("page_url").length&&(c=u.getElementsByTagName("page_url")[0].firstChild.nodeValue.trim());var f="";1===u.getElementsByTagName("stop_url").length&&(f=u.getElementsByTagName("stop_url")[0].firstChild.nodeValue.trim()),this.parameters_.config_url=p,this.parameters_.page_url=c,this.parameters_.stop_url=f,this.updateVideoSlot_(),this.callEvent_("AdLoaded")}else this.stopAd(!0)}else this.stopAd(!0)}else this.stopAd(!0);else this.stopAd(!0)},VpaidVideoPlayer.prototype.timeUpdateHandler_=function(){if(!(this.lastQuartileIndex_>=this.quartileEvents_.length)){this.videoSlot_.currentTime>0&&!this.impressionFired&&this.callEvent_("AdImpression");var e=100*this.videoSlot_.currentTime/this.videoSlot_.duration;if(e>=this.quartileEvents_[this.lastQuartileIndex_].value){var t=this.quartileEvents_[this.lastQuartileIndex_].event;this.callEvent_(t),this.lastQuartileIndex_+=1,"AdVideoComplete"===t&&this.stopAd(!0)}}},VpaidVideoPlayer.prototype.parse_impression_urls=function(e,t){for(var i="undefined"!=typeof t?t:[],n=e.getElementsByTagName("Impression"),r=0;r<n.length;++r){var a=n[r];null!==a.firstChild&&i.push(a.firstChild.nodeValue.trim())}return i},VpaidVideoPlayer.prototype.parse_tracking_event_urls=function(e,t){var i="undefined"!=typeof t?t:{};if(e.getElementsByTagName("TrackingEvents").length>0)for(var n=e.getElementsByTagName("TrackingEvents")[0].getElementsByTagName("Tracking"),r=0;r<n.length;++r){var a=n[r];"undefined"==typeof i[a.getAttribute("event")]&&(i[a.getAttribute("event")]=[]),i[a.getAttribute("event")].push(a.firstChild.nodeValue.trim())}return i},VpaidVideoPlayer.prototype.fetch_xml=function(e,t){var i=this,n=new XMLHttpRequest;n.timeout=5e3,n.open("GET",e,!0),n.onreadystatechange=function(){if(!i.stopped&&4===n.readyState)if(200===n.status){try{var e=new DOMParser,r=e.parseFromString(n.responseText,"text/xml")}catch(a){t(null),t=function(){}}t(r),t=function(){}}else t(null),t=function(){}},n.onerror=function(){i.stopped||(t(null),t=function(){})},n.ontimeout=function(){i.stopped||(t(null),t=function(){})},n.send()},VpaidVideoPlayer.prototype.checkVPAIDInterface=function(e){return e.handshakeVersion&&"function"==typeof e.handshakeVersion&&e.initAd&&"function"==typeof e.initAd&&e.startAd&&"function"==typeof e.startAd&&e.stopAd&&"function"==typeof e.stopAd&&e.skipAd&&"function"==typeof e.skipAd&&e.resizeAd&&"function"==typeof e.resizeAd&&e.pauseAd&&"function"==typeof e.pauseAd&&e.resumeAd&&"function"==typeof e.resumeAd&&e.expandAd&&"function"==typeof e.expandAd&&e.collapseAd&&"function"==typeof e.collapseAd&&e.subscribe&&"function"==typeof e.subscribe&&e.unsubscribe&&"function"==typeof e.unsubscribe},VpaidVideoPlayer.prototype.remove_vpaid=function(e,t){null!==e&&("function"==typeof e.unsubscribe&&(e.unsubscribe("AdLoaded"),e.unsubscribe("AdStarted"),e.unsubscribe("AdStopped"),e.unsubscribe("AdError"),e.unsubscribe("AdSkipped"),e.unsubscribe("AdLinearChange"),e.unsubscribe("AdExpandedChange"),e.unsubscribe("AdRemainingTimeChange"),e.unsubscribe("AdVolumeChange"),e.unsubscribe("AdImpression"),e.unsubscribe("AdVideoStart"),e.unsubscribe("AdVideoFirstQuartile"),e.unsubscribe("AdVideoMidpoint"),e.unsubscribe("AdVideoThirdQuartile"),e.unsubscribe("AdVideoComplete"),e.unsubscribe("AdClickThru"),e.unsubscribe("AdInteraction"),e.unsubscribe("AdUserAcceptInvitation"),e.unsubscribe("AdUserMinimize"),e.unsubscribe("AdUserClose"),e.unsubscribe("AdPaused"),e.unsubscribe("AdPlaying"),e.unsubscribe("AdLog")),e=null);var i=document.getElementById("adloaderframe");null!==i&&document.body.removeChild(i),this.currentVPAIDCreative=null,"function"==typeof t&&t()},VpaidVideoPlayer.prototype.parse_vast_tag=function(e,t,i,n,r,a){var s=this;if(n>3&&(i(null),i=function(){}),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r={}),"undefined"==typeof a&&(a=[]),t.getElementsByTagName("VAST").length>0&&t.getElementsByTagName("VAST")[0].getElementsByTagName("Ad").length>0&&t.getElementsByTagName("VAST")[0].getElementsByTagName("Ad")[0].getElementsByTagName("InLine").length>0){for(var o=t.getElementsByTagName("VAST")[0].getElementsByTagName("Ad")[0],d=o.getElementsByTagName("InLine")[0],l=this.parse_impression_urls(d,a),u=d.getElementsByTagName("Creatives")[0].getElementsByTagName("Creative"),p=0;p<u.length;++p){var c=u[p];if(c.getElementsByTagName("Linear").length>0){for(var f=c.getElementsByTagName("Linear")[0],m=this.parse_tracking_event_urls(f,r),h=f.getElementsByTagName("MediaFiles")[0].getElementsByTagName("MediaFile"),g=!1,v=null,_=0;_<h.length;++_){var b=h[_];if("video/mp4"===b.getAttribute("type")){for(var y=0;y<b.childNodes.length;++y)if(b.childNodes[y].nodeValue.trim().length>0){v=b.childNodes[y].nodeValue.trim();break}if(null!=v)break}else if("application/javascript"===b.getAttribute("type")){for(var y=0;y<b.childNodes.length;++y)if(b.childNodes[y].nodeValue.trim().length>0){g=!0,v=b.childNodes[y].nodeValue.trim();break}if(g)break}}if(null!==v)break}}if(null!==v)if(g){var A=document.createElement("iframe");A.id="adloaderframe",A.style.display="none",document.body.appendChild(A),A.contentWindow.document.write("<html><head></head><body></body></html>");var V=A.contentWindow.document.createElement("script");V.src=v,A.contentWindow.document.getElementsByTagName("head")[0].appendChild(V);var T=setTimeout(function(){clearInterval(E),s.remove_vpaid(null),i(null),i=function(){}},3e3),E=setInterval(function(){var e=A.contentWindow.getVPAIDAd;if(e&&"function"==typeof e){clearInterval(E),clearTimeout(T);var t=e();if(s.currentVPAIDCreative=t,s.checkVPAIDInterface(t))if(t.handshakeVersion("2.0")){var n=null,r=setTimeout(function(){s.remove_vpaid(t),i(null),i=function(){}},1e4),a=!1,o=!1;t.subscribe(function(){a||o||(clearTimeout(r),clearTimeout(n),a=!0,t.stopAd(),s.remove_vpaid(t),i(null),i=function(){})},"AdError"),t.subscribe(function(){a||o||(clearTimeout(r),clearTimeout(n),a=!0,t.stopAd(),s.remove_vpaid(t),i(null),i=function(){})},"AdStopped");var d=[];t.subscribe(function(){d.push("AdPlaying")},"AdPlaying"),t.subscribe(function(){d.push("AdImpression")},"AdImpression"),t.subscribe(function(){d.push("AdVideoStart")},"AdVideoStart"),t.subscribe(function(){s.stopped||(clearTimeout(r),t.subscribe(function(){s.lastEventTime=(new Date).getTime(),clearTimeout(n),o=!0,t.unsubscribe("AdError"),t.unsubscribe("AdStopped"),t.unsubscribe("AdError"),t.unsubscribe("AdPlaying"),t.unsubscribe("AdImpression"),t.unsubscribe("AdVideoStart"),i({src:t,trackingevent_urls:m,impression_urls:l,events:d}),i=function(){}},"AdStarted"),n=setTimeout(function(){t.stopAd(),s.remove_vpaid(t),i(null),i=function(){}},3e4),t.startAd())},"AdLoaded");var u="";f.getElementsByTagName("AdParameters").length>0&&(u=f.getElementsByTagName("AdParameters")[0].firstChild.nodeValue.trim()),t.initAd(s.attributes_.width,s.attributes_.height,s.attributes_.viewMode,s.attributes_.desiredBitrate,{AdParameters:u},s.environmentVars)}else i(null),i=function(){};else i(null),i=function(){}}},10)}else i({src:v,trackingevent_urls:m,impression_urls:l}),i=function(){};else i(null),i=function(){}}else if(t.getElementsByTagName("VAST").length>0&&t.getElementsByTagName("VAST")[0].getElementsByTagName("Ad").length>0&&t.getElementsByTagName("VAST")[0].getElementsByTagName("Ad")[0].getElementsByTagName("Wrapper").length>0){var o=t.getElementsByTagName("VAST")[0].getElementsByTagName("Ad")[0],P=o.getElementsByTagName("Wrapper")[0],l=this.parse_impression_urls(P,a),m=this.parse_tracking_event_urls(P,r),x=P.getElementsByTagName("VASTAdTagURI")[0].firstChild.nodeValue.trim();-1!==x.indexOf("ad4.liverail")?x+="&LR_FORMAT=application/x-shockwave-flash;application/javascript":-1!==x.indexOf("search.spotxchange")&&(x=x.replace("VPAID=1","VPAID=JS")),this.fetch_xml(x,function(t){null!==t?s.parse_vast_tag(e,t,i,++n,m,l):(i(null),i=function(){})})}else i(null),i=function(){}},VpaidVideoPlayer.prototype.fire_url=function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),"undefined"!=typeof t&&(i.timeout=t),i.send()},VpaidVideoPlayer.prototype.fire_trackingevent=function(e,t){if("undefined"!=typeof e[t])for(var i=0;i<e[t].length;++i)this.fire_url(e[t][i])},VpaidVideoPlayer.prototype.fire_impression=function(e){for(var t=0;t<e.length;++t)this.fire_url(e[t])},VpaidVideoPlayer.prototype.try_next_tag=function(e){if(this.impressionFired)return void this.stopAd(!0);if(0===e.length)return void this.stopAd(!0);var t=this,i=e.shift();"undefined"==typeof i.attempted&&(i.attempted=0),++i.attempted,--i.attempts,i.attempts>0&&e.unshift(i),++this.ads_attempted;var n=i.url+"&knocks="+i.attempted;this.fetch_xml(n,function(i){null!==i?t.parse_vast_tag(n,i,function(i){if(null!==i){if("string"==typeof i.src)t.videoSlot_.addEventListener("timeupdate",t.timeUpdateHandler_.bind(t),!1),t.videoSlot_.addEventListener("ended",t.stopAd.bind(t),!1),t.videoSlot_.setAttribute("src",i.src),t.videoSlot_.load(),t.videoSlot_.play();else{var n=i.src,r=!1,a=setInterval(function(){if(null!==t.lastEventTime){var i=(new Date).getTime()-t.lastEventTime;i>1e4&&!r&&(r=!0,clearInterval(a),n.stopAd(),t.remove_vpaid(n,function(){t.try_next_tag(e)}))}},1e3);n.subscribe(function(){r||(r=!0,clearInterval(a),t.remove_vpaid(n,function(){t.try_next_tag(e)}))},"AdStopped"),n.subscribe(function(){r||(r=!0,clearInterval(a),n.stopAd(),t.remove_vpaid(n,function(){t.try_next_tag(e)}))},"AdError"),n.subscribe(function(){},"AdSkipped"),n.subscribe(function(){},"AdLinearChange"),n.subscribe(function(){},"AdExpandedChange"),n.subscribe(function(){},"AdRemainingTimeChange"),n.subscribe(function(){},"AdVolumeChange");for(var s=0;s<i.events.length;++s)t.callEvent_(i.events[s]);n.subscribe(function(){t.lastEventTime=(new Date).getTime(),t.callEvent_("AdImpression")},"AdImpression"),n.subscribe(function(){t.lastEventTime=(new Date).getTime(),t.callEvent_("AdVideoStart")},"AdVideoStart"),n.subscribe(function(){t.lastEventTime=(new Date).getTime(),t.callEvent_("AdVideoFirstQuartile")},"AdVideoFirstQuartile"),n.subscribe(function(){t.lastEventTime=(new Date).getTime(),t.callEvent_("AdVideoMidpoint")},"AdVideoMidpoint"),n.subscribe(function(){t.lastEventTime=(new Date).getTime(),t.callEvent_("AdVideoThirdQuartile")},"AdVideoThirdQuartile"),n.subscribe(function(){t.lastEventTime=(new Date).getTime(),t.callEvent_("AdVideoComplete")},"AdVideoComplete"),n.subscribe(function(){},"AdClickThru"),n.subscribe(function(){},"AdInteraction"),n.subscribe(function(){},"AdUserAcceptInvitation"),n.subscribe(function(){},"AdUserMinimize"),n.subscribe(function(){},"AdUserClose"),n.subscribe(function(){},"AdPaused"),n.subscribe(function(){},"AdPlaying"),n.subscribe(function(){},"AdLog")}t.trackingevent_urls=i.trackingevent_urls,t.impression_urls=i.impression_urls}else t.try_next_tag(e)}):t.try_next_tag(e)})},VpaidVideoPlayer.prototype.updateVideoSlot_=function(){null===this.videoSlot_&&(this.videoSlot_=document.createElement("video"),this.slot_.appendChild(this.videoSlot_)),this.updateVideoPlayerSize_()},VpaidVideoPlayer.prototype.updateVideoPlayerSize_=function(){this.videoSlot_.setAttribute("width",this.attributes_.width),this.videoSlot_.setAttribute("height",this.attributes_.height)},VpaidVideoPlayer.prototype.startAd=function(){var e=this;this.callEvent_("AdStarted"),this.load_config(function(t){if(null!==t)if("undefined"!=typeof t.config){var i=t.config.waterfall.elements;i.sort(function(e,t){return e.tagOrder-t.tagOrder}),e.try_next_tag(i)}else e.stopAd(!0);else e.stopAd(!0)})},VpaidVideoPlayer.prototype.load_config=function(e){var t="";try{var i=window,n=!1;do i.self===window.top?(t=i.location.href,n=!0):"about:"===i.location.href.substring(0,6)||"javascript:"===i.location.href.substring(0,11)||i.location.host===i.parent.location.host?i=i.parent:n=!0;while(!n)}catch(r){t=window.location.href}finally{(null===t||0===t.length||t.indexOf("javascript:")>=0||t.indexOf("about:blank")>=0||t.indexOf(".doubleclick.net")>=0||t.indexOf(".adnxs.com")>=0||t.indexOf("data.rtbfy.com")>=0||t.indexOf("tpc.googlesyndication.com")>=0||t.indexOf(".rev2pub.com")>=0||t.indexOf("s.admtpmp")>=0||t.indexOf(".adk2x.com")>=0||t.indexOf("ads.waframedia")>=0||t.indexOf("ads-by.madadsmedia")>=0||t.indexOf("delivery.roimediadigital.com")>=0||t.indexOf(".smartyads.com")>=0||t.indexOf("us-ads.openx.net")>=0||t.indexOf(".zedo.com")>=0||t.indexOf("da-ads.com")>=0||t.indexOf("cdn.adnotch.com")>=0||t.indexOf("r.254a.com")>=0||t.indexOf("l.yimg.com")>=0||t.indexOf("ads.yahoo.com")>=0||t.indexOf("ds.serving-sys.com")>=0||t.indexOf("live.sekindo.com")>=0||t.indexOf("media.adfrontiers.com")>=0||t.indexOf("o.aolcdn.com")>=0||t.indexOf("p.ato.mx")>=0||t.indexOf("api.merchenta.com")>=0||t.indexOf("ads.lfstmedia.com")>=0||t.indexOf("cdn.cavixoapp.com")>=0||t.indexOf("swf.mixpo.com")>=0)&&(t=this.parameters_.page_url)}var a=this.parameters_.config_url+"&format=json&page_url="+encodeURIComponent(t)+"&page_url2="+encodeURIComponent(this.parameters_.page_url)+"&player_width="+this.attributes_.width+"&player_height="+this.attributes_.height,s=new XMLHttpRequest;s.timeout=5e3,s.open("GET",a,!0);s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){try{var t=JSON.parse(s.responseText.trim())}catch(i){e(null),e=function(){}}e(t),e=function(){}}else e(null),e=function(){}},s.onerror=function(){e(null),e=function(){}},s.ontimeout=function(){e(null),e=function(){}},s.send()},VpaidVideoPlayer.prototype.stopAd=function(e){if(!this.stopped){this.stopped=!0;var t=this;if(("undefined"==typeof e||"object"==typeof e)&&(e=!1),this.parameters_.stop_url.length>0){var i=this.parameters_.stop_url;i=i.replace("{LIFETIME}",(new Date).getTime()-this.startTime),i=i.replace("{EXTERNAL}",+!e),i=i.replace("{ADS}",this.ads_attempted),this.fire_url(i,1e3)}this.remove_vpaid(this.currentVPAIDCreative),setTimeout(function(){t.callEvent_("AdStopped")},1e3)}},VpaidVideoPlayer.prototype.setAdVolume=function(e){this.attributes_.volume=e,this.callEvent_("AdVolumeChanged")},VpaidVideoPlayer.prototype.getAdVolume=function(){return this.attributes_.volume},VpaidVideoPlayer.prototype.resizeAd=function(e,t,i){this.attributes_.width=e,this.attributes_.height=t,this.attributes_.viewMode=i,this.updateVideoPlayerSize_(),this.callEvent_("AdSizeChange")},VpaidVideoPlayer.prototype.pauseAd=function(){this.videoSlot_.pause(),this.callEvent_("AdPaused")},VpaidVideoPlayer.prototype.resumeAd=function(){this.videoSlot_.play(),this.callEvent_("AdPlaying")},VpaidVideoPlayer.prototype.expandAd=function(){this.callEvent_("AdExpanded")},VpaidVideoPlayer.prototype.getAdExpanded=function(){return this.attributes_.expanded},VpaidVideoPlayer.prototype.getAdSkippableState=function(){return this.attributes_.skippableState},VpaidVideoPlayer.prototype.collapseAd=function(){this.attributes_.expanded=!1},VpaidVideoPlayer.prototype.skipAd=function(){var e=this.attributes_.skippableState;e&&this.callEvent_("AdSkipped")},VpaidVideoPlayer.prototype.subscribe=function(e,t,i){var n=e.bind(i);this.eventsCallbacks_[t]=n},VpaidVideoPlayer.prototype.unsubscribe=function(e){this&&this.eventsCallbacks_&&(this.eventsCallbacks_[e]=null)},VpaidVideoPlayer.prototype.getAdWidth=function(){return this.attributes_.width},VpaidVideoPlayer.prototype.getAdHeight=function(){return this.attributes_.height},VpaidVideoPlayer.prototype.getAdRemainingTime=function(){return this.attributes_.remainingTime},VpaidVideoPlayer.prototype.getAdDuration=function(){return this.attributes_.duration},VpaidVideoPlayer.prototype.getAdCompanions=function(){return this.attributes_.companions},VpaidVideoPlayer.prototype.getAdIcons=function(){return this.attributes_.icons},VpaidVideoPlayer.prototype.getAdLinear=function(){return this.attributes_.linear},VpaidVideoPlayer.prototype.callEvent_=function(e){e in this.eventsCallbacks_&&this.eventsCallbacks_[e](),"AdSkipped"===e?this.fire_trackingevent(this.trackingevent_urls,"skip"):"AdStarted"===e||("AdImpression"===e?this.impressionFired||(this.fire_impression(this.impression_urls),this.impressionFired=!0):this.impressionFired&&"AdVideoStart"===e?this.fire_trackingevent(this.trackingevent_urls,"start"):this.impressionFired&&"AdVideoFirstQuartile"===e?this.fire_trackingevent(this.trackingevent_urls,"firstQuartile"):this.impressionFired&&"AdVideoMidpoint"===e?this.fire_trackingevent(this.trackingevent_urls,"midpoint"):this.impressionFired&&"AdVideoThirdQuartile"===e?this.fire_trackingevent(this.trackingevent_urls,"thirdQuartile"):this.impressionFired&&"AdVideoComplete"===e?this.fire_trackingevent(this.trackingevent_urls,"complete"):"AdPaused"===e?this.fire_trackingevent(this.trackingevent_urls,"pause"):"AdPlaying"===e&&this.fire_trackingevent(this.trackingevent_urls,"resume"))};var getVPAIDAd=function(){return new VpaidVideoPlayer};